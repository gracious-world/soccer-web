Mango=window.Mango||{},Mango.Config=function(){return{gameType:"football",containers:{gamesFilter:$("#wayFilter"),games:$("#gamesContainer"),betting:$("#submitContainer"),champion:$(".e_main")},events:{},gameConfigUrl:"/game-config",gameDataUrl:"/game-data",gameBettingUrl:"/betting",oddParam:{},oddBlockClass:{h:"blockWin",ch:"blockWin",d:"blockPing",cd:"blockPing",a:"blockFu",ca:"blockFu",other:"blockYel"},scriptTmpl:{gamesList:$("#gamesList"),gamesHistoryList:$("#gamesHistoryList"),selectedGames:$("#selectedGames"),selectedOdds:$("#selectedOdds"),gatesBox:$("#gatesBox"),gameForm:$("#gameForm"),gamesMenu:$("#focusGamesMenu"),champion:$("#championTmpl"),championship:$("#championshipTmpl")},gameConfig:null}}(),Mango.Data=function(){var e=null,n={game_type:"football"},t=null,i=!0,a=null,o=new UIscript.Mask,s=new UIscript.MiniWindow,r={implant:!1,callback:null},c=function(e,n,t,i){if(!e)return!1;$.ajax({url:e,type:"GET",dataType:"json",data:t,beforeSend:function(){o.show()},success:function(e){n(e,t),s.hideTip()},complete:function(){s.showTip("正在加载数据"),setTimeout(function(){s.hideTip(),o.hide()},1e3)},error:function(a){c(e,n,t,i)}})},l=function(){c(e.gameConfigUrl,d,n)},d=function(e,n){e.coding<0&&confirm("获取游戏数据失败，是否返回首页？")&&(window.location.href="/"),Mango.Config.gameConfig=e.data,Mango.Config.gameConfig.defaultWays=Array.minus(Mango.Config.gameConfig.ways,Mango.Config.gameConfig.extra_ways),u()},u=function(i){t=i,c(e.gameDataUrl,m,$.extend({},n,t||{}))},m=function(n,t){n.coding<0?r.implant?r.implant&&r.callback&&r.callback():confirm("获取游戏数据失败，是否返回首页？")&&(window.location.href="/"):r.implant&&r.implant&&r.restore&&r.restore();var a=moment().format("YYYY-MM-DD");(i=!t||!t.bet_date||t.bet_date>=a)?f():g();var o=+isFocusGame?"gamesList":["gamesList","gamesHistoryList"][Number(t.bet_date<a)];e.callback(e.gamesContainer,n.data,o,!0)},f=function(){g(),a=setInterval(function(){u(t)},3e5)},g=function(){a&&clearInterval(a)};return{init:function(n){return e=$.extend(e,null,n||{}),l(),this},getGameData:u,set:function(e,n){switch(e){case"implant":$.extend(r,n)}}}}(),Mango.Render=function(){return{render:function(e,n,t,i,a){var o=$(t).html(),s=doT.template(o)(n);i&&$(e).html(""),a?$(a).before(s):$(e).append(s)}}}(),Mango.Game=function(){var e={},n=!1,t=$(".focusleft,.focusright"),i=function(){e.gamesListBox=$(e.gamesContainer).find(".gamesList"),e.gamesMenuBox=$(e.gamesContainer).find(".gamesMenu")},a=function(){e.gamesMenuBox.on("click",function(e){if(!n){var t=e.target||e.srcElement,i=$(t).attr("action_type");switch(i||(t=$(t).parent(),i=$(t).attr("action_type")),i||e.stopPropagation(),i){case"gameSwitcher":c(t)}}})},o=function(){e.gamesListBox.on("click keyup",function(e){var n=e.target||e.srcElement,t=$(n).attr("action_type"),i=n;switch(t||(t=(i=$(n).parents("[action_type]")).attr("action_type")),t||e.stopPropagation(),t){case"tabSwitcher":r(n);break;case"chooseOdd":l(i);break;case"betting":p($(n).parents(".bettingBox"));break;case"multipleTuner":s(n,i||n)}})},s=function(e,n){var t=$(n).find("input[name=multiple]"),i=+$(t).val();$(e).hasClass("minusMultiple")&&$(t).val(i>1?i-1:1),$(e).hasClass("plusMultiple")&&$(t).val(i<99999999?i+1:99999999);var a=$(e).parents(".wayBox"),o=a.attr("index").split("_"),s=o[0];o[1];d(s,a),gi},r=function(e){$(e).addClass("on").siblings("li").removeClass("on");var n=$(e).index();$(e).parent().siblings(".focusbox").find(".focuschild").hide().eq(n).show()},c=function(t){var i=$(t).index(),a=e.gamesListBox.find(".gameBox").eq(i);n=!0,$("html,body").animate({scrollTop:$(a).offset().top},500,function(){n=!1,v()}),$(t).addClass("on").siblings().removeClass("on")},l=function(e){var n=$(e).parent("li");n.hasClass("on")?(!1,n.removeClass("on")):(!0,n.addClass("on"));var t=$(e).parents(".wayBox"),i=t.attr("index").split("_"),a=i[0];i[1];d(a,t)},d=function(e,n){var t=n.find(".bettingBox"),i=$(t).find("input[name=multiple]").val(),a=u(e,i,n),o=a.gamesJson,s=a.referPrizeArr,r=calculateBetsNum(o,[e],{"1x1":[1]},[]),c=+r*i*2,l=0,d=0;if(1==s.length)l=(+s[0]).toFixed(2),d=(+s[0]-c).toFixed(2);else if(0==s.length)l=0,d=0;else{var m=s.min(),f=s.max();l=m+"~"+f,d=(m-c).toFixed(2)+"~"+(f-c).toFixed(2)}$(t).attr("order_data",JSON.stringify(o)).find("input[name=bet_num]").val(r).end().find(".amountText").text(c).end().find(".referPrizeText").text(l).end().find(".profitText").text(d)},u=function(e,n,t){var i={};i[e]=[];var a=[],o=[],s=[];return $(t).find("li.on").each(function(t){var o=$(this).find("div[action_type=chooseOdd]").attr("data");if(o=JSON.parse(o),$.isArray(o.name))for(var s=o.name.length-1;s>=0;s--)i[e].push(o.name[s]+"_"+o.odd[s]),a.push((o.odd[s]*n*2).toFixed(2));else i[e].push(o.name+"_"+o.odd[0]),a.push((o.odd*n*2).toFixed(2))}),$.each(i[e],function(e,n){-1===$.inArray(n,o)&&o.push(n)}),$.each(a,function(e,n){-1===$.inArray(n,s)&&s.push(n)}),i[e]=o,a=s,{gamesJson:i,referPrizeArr:a}},m=function(n,t){var i=new UIscript.MiniWindow,a=new UIscript.Message;$.ajax({url:e.billSubmitUrl,type:"POST",dataType:"json",data:n||{},beforeSend:function(){i.showTip("提交中...")},success:function(e){f(e,i,a,t)},complete:function(e){i.hideTip()},error:function(e){g(e,a,t)}})},f=function(e,n,t,i){n.hideTip();var a='<div class="bd text-center"><div class="pop-title"><i class="ico-error"></i><h4 class="pop-text">'+(e&&e.msg?e.msg:"")+"<br></h4></div></div>";+e.coding>0&&(a='<div class="bd text-center"><div class="pop-title"><i class="ico-success"></i><h4 class="pop-text">'+e.msg+'<br></h4></div><p class="text-note" style="padding:5px 0;">您可以通过”投注记录“查询您的投注记录！</p></div>',h(i)),t.show({isShowMask:!0,confirmIsShow:!0,confirmText:"关 闭",confirmFun:function(){t.hide()},content:a})},g=function(e,n){n.hide();var t="服务器信息错误,请在投注列表中查询";401==e.status&&(t="您没有登录或没有投注权限"),n.show({isShowMask:!0,confirmIsShow:!0,confirmText:"关 闭",confirmFun:function(){n.hide()},content:'<div class="pop-waring"><i class="ico-waring"></i><h4 class="pop-text">'+t+"</h4></div>"})},p=function(e){var n=new UIscript.Mask,t=new UIscript.MiniWindow,i="",a=!0,o=e.find("input[name=multiple]").val(),s=e.find("input[name=bet_num]").val(),r=JSON.parse(e.attr("order_data")),c=e.attr("way_type"),l=s*o*2;if((!r||r.length<1)&&(i="缺少投注数据",a=!1),!a)return n.show(),t.showTip(i),setTimeout(function(){n.hide(),t.hideTip()},1e3),!1;var d={max_gate:Mango.Config.gameConfig.max_gates[c],gate:["1x1"],games:r,dan:[],bet_num:s,multiple:o,amount:l};m(d,e)},h=function(n){$(n).attr("order_data","").find("input[name=bet_num]").val(0).end().find(".amountText").text(0).end().find(".referPrizeText").text(0).end().find(".profitText").text(0),$(e.gamesContainer).find(".wayBox").find("li.on").removeClass("on")},v=function(e){var n=Math.max(document.body.scrollTop||document.documentElement.scrollTop);e&&$(".fevent").each(function(e){var t=$(this).offset().top-50;if(n<=t)return!1;$(".Flefteventlist").eq(e-$(".fevent").length).addClass("on").siblings().removeClass("on")}),n>120?$(window).height()>365&&t.animate({top:0},5):t.animate({top:"93px"},5)},x=function(e,n){$(document).on("keydown",e,function(e){if(35!=e.keyCode&&36!=e.keyCode&&46!=e.keyCode&&8!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode){if(!(e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105))return!1;if($.trim($(this).val()).length>6)return!1}}).on("keyup",e,function(){this.value=Math.max(this.value,1),n&&n.constructor==Function&&n()})};return{init:function(t){e=$.extend(e,null,t||{}),i(),a(),o(),x(".Fmultiple input"),$(window).scroll(function(){n||v(!0)}).trigger("scroll")},initCountDown:function(){$(".countDown").each(function(e,n){var t=$.trim(n.getAttribute("data-time")),i=new Date(Date.parse(t.replace(/-/g,"/"))).getTime();$(n).countdown({timestamp:i,callback:function(e,n,t,i){}})})}}}();